<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--=============== FLATICON ===============-->
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/2.0.0/uicons-regular-straight/css/uicons-regular-straight.css"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!--=============== SWIPER CSS ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/variant-selector.css" />
    <link rel="stylesheet" href="/css/ios-toast.css" />
    <link rel="stylesheet" href="/css/product-images.css" />
    <link rel="stylesheet" href="/css/wishlist-heart.css" />
    <link rel="stylesheet" href="/css/variant-popup.css" />
    <link rel="stylesheet" href="/css/wishlist-heart.css" />

    <title>Ecommerce Website</title>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ HEADER ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <%- include('../layouts/header.ejs')  %>

    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== BREADCRUMB ===============-->
      <%- include('../layouts/breadcrumbs.ejs')  %>
      
      <!--=============== DETAILS ===============-->
      <input type="hidden" name="" value="<%= product._id  %>" id="productIdStore" data-product-id="<%= product._id %>">

      <section class="details section--lg">
        <div class="details__container container grid">

          <div class="details__group image-zoom-container">
            <% if (product.images && product.images.length > 0) { %>
              <img
                src="/<%= product.images[0] %>"
                alt="<%= product.name %>"
                class="details__img mainImage"
                id="mainImage"
                onmouseover="enableZoom(event)"
                onmouseout="disableZoom()"
              />
              <div class="zoom-overlay" id="zoomOverlay"></div>
              <div class="details__small-images grid">
                <% product.images.forEach((image, index) => { %>
                  <% if (index > 0 && image) { %>
                    <img
                      src="/<%= image %>"
                      alt="<%= product.name %> - Image <%= index + 1 %>"
                      class="details__small-img"
                      onclick="changeMainImage(this)"
                    />
                  <% } %>
                <% }) %>
              </div>
            <% } else { %>
              <div class="no-image-placeholder">
                <i class="fas fa-image"></i>
                <p>No images available</p>
              </div>
            <% } %>
          </div>

          <div class="details__group">
            <h3 class="details__title"><%= product.name %></h3>
            <p class="details__brand">Brand: <span><%= product.brand?.name || 'No Brand' %></span></p>
            
            <div class="details__price flex">
              <% if(typeof hasOffer !== 'undefined' && hasOffer && typeof discountedPrice !== 'undefined' && discountedPrice) { %>
                <span class="new__price offerPriceProduct">&#8377;<%= Math.round(discountedPrice) %></span>
                <span class="old__price">&#8377;<%= Math.round(displayPrice) %></span>
                <% if(typeof discountPercentage !== 'undefined' && discountPercentage > 0) { %>
                  <span class="save__price"><%= discountPercentage %>% Off</span>
                <% } %>
                <% if(typeof isFestivalOffer !== 'undefined' && isFestivalOffer && typeof festivalName !== 'undefined' && festivalName) { %>
                  <span class="festival-offer-tag">
                    <%= festivalName %> Offer
                  </span>
                <% } %>
              <% } else { %>
                <span class="new__price">&#8377;<%= Math.round(displayPrice) %></span>
              <% } %>
            </div>
            
            <p class="short__description">
              <%= product.description %>
            </p>
            
            <ul class="products__list">
              <li class="list__item flex">
                <i class="fi-rs-crown"></i> <%= product.warranty ? product.warranty : 'No Warranty Available' %>
              </li>
              <li class="list__item flex">
                <i class="fi-rs-refresh"></i> <%= product.returnPolicy ? product.returnPolicy : 'No Return Policy' %>
              </li>
              <li class="list__item flex">
                <i class="fi-rs-credit-card"></i> <%= product.cashOnDelivery ? 'Cash on Delivery available' : 'No Cash on Delivery available' %>
              </li>
            </ul>

            <div id="variant-selector" class="variant-selector-container">
            </div>

            <div class="details__action add-to-cart-section">
              <input type="number" class="quantity" id="quantity" value="1" min="1" step="1"/>
              <button class="btn btn--sm add-to-cart-btn" disabled>Add To Cart</button>
              <button class="btn btn--sm buy-now-btn" disabled>Buy Now</button>
              
              <% if(isAlreadyWishlist){ %>        
                <a data-id="<%= product._id %>" data-wishlist-item-id="<%= wishlistItemId %>" class="details__action-btn wishlistDiv wishlist-active"  id="wishlistButton">
                  <i class="fi fi-rs-heart wishlistIcon filled"></i>
                </a>         
              <% } else { %>
                <a data-id="<%= product._id %>" class="details__action-btn wishlistDiv"  id="wishlistButton">
                  <i class="fi fi-rs-heart wishlistIcon"></i>
                </a>         
              <% } %>
            </div>
            
            <ul class="details__meta">
              <li class="meta__list flex">
                <% let tags = ""; %>
                <% product.tags.forEach(val => { %>
                  <% tags += val + ", "; %>
                <% }) %>
                <span>Tags:</span><%= tags.slice(0, -2) %> 
              </li>
              <li class="meta__list flex">
                Availability: <span class="stockText">Select options to see availability</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!--=============== DETAILS TAB ===============-->
      <section class="details__tab container">
        <div class="detail__tabs">
          <span class="detail__tab" data-target="#reviews">Reviews(<%= product.reviews.length %>)</span>
        </div>
        <div class="details__tabs-content review">
          <div class="details__tab-content" content id="reviews">
            <div class="reviews__container grid reviewShowSection">
              <!-- Reviews will be loaded here -->
            </div>
            <% if(isBuyedUser){ %>
              <div class="review__form">
                <h4 class="review__form-title">Add a review</h4>
                <div class="rate__product">
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                </div>
                <form action="" class="form grid">
                  <textarea
                    class="form__input textarea reviewTextarea"
                    placeholder="Write Comment"
                  ></textarea>
                  <div class="form__btn">
                    <button class="btn btnSubmitReview">Submit Review</button>
                  </div>
                </form>
              </div>
            <% } %>
          </div>
        </div>
      </section>

      <!--=============== PRODUCTS ===============-->
      <section class="products container section--lg">
        <h3 class="section__title"><span>Related</span> Products</h3>
        <div class="products__container grid">
          <% relatedProducts.forEach(data=>{ %>
            <div class="product__item">
              <div class="product__banner">
                <a href="/details/<%= data._id  %>" class="product__images">
                  <% if (data.images && data.images.length > 0 && data.images[0]) { %>
                    <img
                      src="/<%= data.images[0] %>"
                      alt="<%= data.name %>"
                      class="product__img default"
                    />
                    <% if (data.images.length > 2 && data.images[2]) { %>
                      <img
                        src="/<%= data.images[2] %>"
                        alt="<%= data.name %>"
                        class="product__img hover"
                      />
                    <% } %>
                  <% } else { %>
                    <div class="product__img default no-image-placeholder">
                      <i class="fas fa-image"></i>
                      <p>No Image</p>
                    </div>
                  <% } %>
                </a>
                <div class="product__actions">
                  <a href="#" class="action__btn" aria-label="Quick View">
                    <i class="fi fi-rs-eye"></i>
                  </a>
                  <a
                    href="#"
                    class="action__btn"
                    aria-label="Add to Wishlist"
                  >
                    <i class="fi fi-rs-heart"></i>
                  </a>
                </div>
                <div class="product__badge light-pink">Hot</div>
              </div>
              <div class="product__content">
                <span class="product__category"><%= category ? category.name : "Unknown Category" %></span>
                <a href="/details/<%= data._id  %>">
                  <h3 class="product__title"><%= data.name %></h3>
                </a>
                <div class="product__rating">
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                  <i class="fi fi-rs-star"></i>
                </div>
                <div class="product__price flex">
                  <% if(data.hasOffer) { %>
                    <span class="new__price">&#8377;<%= Math.round(data.finalPrice) %></span>
                    <span class="old__price">&#8377;<%= Math.round(data.originalPrice) %></span>
                    <% if(data.isPercentageOffer) { %>
                      <span class="save__price"><%= data.discountPercentage %>% Off</span>
                    <% } %>
                  <% } else { %>
                    <span class="new__price">&#8377;<%= Math.round(data.originalPrice || data.basePrice || data.price) %></span>
                  <% } %>
                </div>
                <a
                  href="#"
                  class="action__btn cart__btn"
                  aria-label="Add To Cart"
                >
                  <i class="fi fi-rs-shopping-bag-add"></i>
                </a>
              </div>
            </div>
          <% }) %>
        </div>
      </section>

      <!--=============== NEWSLETTER ===============-->
      <section class="newsletter section">
        <div class="newsletter__container container grid">
          <h3 class="newsletter__title flex">
            <img
              src="/img/icon-email.svg"
              alt=""
              class="newsletter__icon"
            />
            Sign in to Newsletter
          </h3>
          <p class="newsletter__description">
            ...and receive $25 coupon for first shopping.
          </p>
          <form action="" class="newsletter__form">
            <input
              type="text"
              placeholder="Enter Your Email"
              class="newsletter__input"
            />
            <button type="submit" class="newsletter__btn">Subscribe</button>
          </form>
        </div>
      </section>
    </main>

   <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ FOOTER ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
   <%- include('../layouts/footer.ejs')  %>

    <!--=============== SWIPER JS ===============-->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="/js/ios-toast.js"></script>

    <!-- Dynamic Variant Selector -->
    <script src="/js/variantSelector.js"></script>
    
    <!--=============== MAIN JS ===============-->
    <script src="/js/variantSelector.js"></script>
    <script src="/js/variantPopup.js"></script>
    <script src="/js/user/details.js"></script>
  </body>
</html>
